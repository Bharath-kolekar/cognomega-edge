import React, { useEffect, useRef, useState } from 'react'
import { CreateWebWorkerMLCEngine } from '@mlc-ai/web-llm'
const API_BASE = (import.meta as any).env.VITE_API_BASE ?? ''
export default function App(){const [ready,setReady]=useState(false);const [resp,setResp]=useState('');const [health,setHealth]=useState('checking...');const engineRef=useRef<any>(null);const [prompt,setPrompt]=useState('Summarize Cognomega in one line.');useEffect(()=>{fetch(`${API_BASE}/ready`).then(r=>r.json()).then(j=>setHealth(JSON.stringify(j))).catch(()=>setHealth('down'));(async()=>{try{engineRef.current=await CreateWebWorkerMLCEngine(new URL('/'),{model:'Llama-3.1-8B-Instruct-q4f16_1-MLC'});setReady(true)}catch(e){setResp('WebLLM not available on this browser.')}})()},[]);const ask=async()=>{if(!engineRef.current)return;const reply=await engineRef.current.chat.completions.create({messages:[{role:'user',content:prompt}],temperature:0.7,stream:false});setResp(reply.choices[0]?.message?.content??'')};return (<div style={{maxWidth:820,margin:'40px auto',fontFamily:'system-ui'}}><h1>Cognomega</h1><p>API readiness: {health}</p><div style={{display:'flex',gap:8}}><input style={{flex:1,padding:8}} value={prompt} onChange={e=>setPrompt(e.target.value)}/><button onClick={ask} disabled={!ready}>Ask</button></div><pre style={{whiteSpace:'pre-wrap',background:'#111',color:'#0f0',padding:12,marginTop:12}}>{resp}</pre><hr/><form method='post' action={`${API_BASE}/v1/files/upload`} encType='multipart/form-data'><label>Upload file (to R2): </label><input type='file' name='file' required/><button type='submit'>Upload</button></form></div>) }

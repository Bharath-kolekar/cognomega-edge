import { defineConfig } from "vite";
import react from "@vitejs/plugin-react";

const target = "https://api.cognomega.com";

export default defineConfig({
  plugins: [react()],
  server: {
    port: 5173,
    strictPort: true,
    proxy: {
      // ---- specific health/ready rewrites (take precedence) ----
      "/ready":        { target, changeOrigin: true, secure: true, cookieDomainRewrite: "localhost", rewrite: () => "/api/v1/healthz" },
      "/api/ready":    { target, changeOrigin: true, secure: true, cookieDomainRewrite: "localhost", rewrite: () => "/api/v1/healthz" },
      "/health":       { target, changeOrigin: true, secure: true, cookieDomainRewrite: "localhost", rewrite: () => "/api/v1/healthz" },
      "/healthz":      { target, changeOrigin: true, secure: true, cookieDomainRewrite: "localhost", rewrite: () => "/api/v1/healthz" },
      "/api/health":   { target, changeOrigin: true, secure: true, cookieDomainRewrite: "localhost", rewrite: () => "/api/v1/healthz" },
      "/api/healthz":  { target, changeOrigin: true, secure: true, cookieDomainRewrite: "localhost", rewrite: () => "/api/v1/healthz" },

      // ---- guest auth fallbacks → rewrite to healthz to avoid 404 spam ----
      "/auth/guest":   { target, changeOrigin: true, secure: true, cookieDomainRewrite: "localhost", rewrite: () => "/api/v1/healthz" },
      "/api/gen-jwt":  { target, changeOrigin: true, secure: true, cookieDomainRewrite: "localhost", rewrite: () => "/api/v1/healthz" },
      "/gen-jwt":      { target, changeOrigin: true, secure: true, cookieDomainRewrite: "localhost", rewrite: () => "/api/v1/healthz" },

      // ---- general API proxies ----
      "/api":     { target, changeOrigin: true, secure: true, cookieDomainRewrite: "localhost" },
      "/v1":      { target, changeOrigin: true, secure: true, cookieDomainRewrite: "localhost" },
      "/auth":    { target, changeOrigin: true, secure: true, cookieDomainRewrite: "localhost" },
      "/credits": { target, changeOrigin: true, secure: true, cookieDomainRewrite: "localhost" },
      "/billing": { target, changeOrigin: true, secure: true, cookieDomainRewrite: "localhost" }
    }
  }
});
